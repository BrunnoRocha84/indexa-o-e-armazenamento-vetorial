Este repositÃ³rio contÃ©m a camada de indexaÃ§Ã£o e armazenamento vetorial (Vector Store) utilizada pelo agente de IA empresanho OperaÃ§Ãµes, responsÃ¡vel por responder perguntas relacionadas aos POPs e documentos internos do time de OperaÃ§Ãµes.

A indexaÃ§Ã£o Ã© realizada a partir do Google Drive e sincronizada periodicamente com este banco de vetores hospedado no Supabase.

ğŸ—ï¸ Arquitetura do RAG

O pipeline completo segue o fluxo:

Google Drive  â†’  n8n (IngestÃ£o)  
             â†’  OpenAI Embeddings  
             â†’  Supabase Vector Store  
             â†’  Agente LLM (LangChain / LangGraph)  

ğŸ”¹ Componentes

Google Drive â†’ fonte original dos POPs

n8n â†’ orquestra ingestÃ£o, detecÃ§Ã£o de mudanÃ§as e reindexaÃ§Ã£o

OpenAI text-embedding-3-large â†’ geraÃ§Ã£o dos vetores

Supabase (pgvector) â†’ armazenamento dos embeddings

LangChain / LangGraph â†’ camada de retrieval + resposta do agente

ğŸ“¦ Fluxo de IngestÃ£o (n8n)

A ingestÃ£o no n8n realiza:

âœ” Rastreamento recursivo de pastas do Drive

Com controle de profundidade e processamento em batches.

âœ” Filtros de qualidade

blacklist de pastas e arquivos

mimetypes permitidos (ex.: Google Docs)

âœ” VerificaÃ§Ã£o de atualizaÃ§Ã£o

O sistema sÃ³ reindexa arquivos quando:

sÃ£o novos

ou foram modificados no Drive (updated_at > metadata.updated_at)

âœ” ReindexaÃ§Ã£o inteligente

Ao detectar mudanÃ§as:

remove o embedding antigo

extrai o conteÃºdo atualizado

gera novo embedding

salva no Supabase

âœ” Metadados armazenados

Cada documento inclui:

id do Drive

file_name

url

path

agent

created_at

updated_at

tipo de documento

conteÃºdo text-only processado

ğŸ—ƒï¸ Estrutura da Tabela documents

A tabela segue o padrÃ£o do LangChain Vector Store:

id                TEXT PRIMARY KEY
embedding         VECTOR(3072)
content           TEXT
metadata          JSONB

Exemplo de metadata:
{
  "id": "1aB2C3d4E5",
  "agent": "agente_operacoes",
  "file_name": "POP - Abertura de Chamados",
  "url": "https://drive.google.com/file/d/1aB2C3d4E5/view",
  "path": "/OperaÃ§Ãµes/POPs/Chamados",
  "created_at": "2024-02-11T14:22:04",
  "updated_at": "2024-02-18T09:12:54"
}

ğŸ” Como funciona a busca (Retrieval)

A camada LLM utiliza Hybrid Retrieval:

Busca vetorial (similaridade semÃ¢ntica via pgvector)

Busca lexical (BM25 opcional em outra tabela)

Reranking (Cohere Reranker opcional)

O objetivo Ã© retornar sempre os trechos mais relevantes e recentes para as respostas.

ğŸ§ª Exemplo de Query Vetorial (Supabase)
SELECT
  id,
  content,
  metadata,
  embedding <#> '[0.23, -0.11, ...]' AS similarity
FROM documents
ORDER BY similarity ASC
LIMIT 5;

ğŸ¤– IntegraÃ§Ã£o com o Agente

O agente LLM pode ser implementado em:

LangChain

LangGraph

FastAPI

Node.js

Python puro

Exemplo simples com LangChain:

from langchain.chat_models import ChatOpenAI
from langchain.vectorstores import SupabaseVectorStore
from langchain.embeddings import OpenAIEmbeddings

llm = ChatOpenAI(model="gpt-4o-mini")
emb = OpenAIEmbeddings(model="text-embedding-3-large")

vectorstore = SupabaseVectorStore(
    table_name="documents",
    embedding=emb,
    query_name="match_documents"
)

retriever = vectorstore.as_retriever()


ğŸ”„ AtualizaÃ§Ãµes

O fluxo Ã© atualizado automaticamente via n8n Schedule Trigger, garantindo que novas alteraÃ§Ãµes no Drive sejam refletidas no Supabase sem necessidade manual.

ğŸ› ï¸ Tecnologias Utilizadas

Supabase (PostgreSQL + pgvector)

n8n

OpenAI Embeddings

LangChain

LangGraph

Google Drive API

ğŸ“ Suporte / ManutenÃ§Ã£o

O agente estÃ¡ registrado como:
agent: "empresanho_operacoes"

Para adicionar novos documentos, basta inserir no Google Drive dentro da pasta monitorada.

Para apagar ou reprocessar documentos manualmente, consulte a tabela documents.